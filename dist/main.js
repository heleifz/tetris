!function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="./dist/",i(i.s=8)}([function(t,e,i){var s=i(1),o=i(2);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[t.i,o,""]]);var n={insert:"head",singleton:!1};s(o,n);t.exports=o.locals||{}},function(t,e,i){"use strict";var s,o=function(){return void 0===s&&(s=Boolean(window&&document&&document.all&&!window.atob)),s},n=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}(),h=[];function r(t){for(var e=-1,i=0;i<h.length;i++)if(h[i].identifier===t){e=i;break}return e}function l(t,e){for(var i={},s=[],o=0;o<t.length;o++){var n=t[o],l=e.base?n[0]+e.base:n[0],a=i[l]||0,c="".concat(l," ").concat(a);i[l]=a+1;var u=r(c),d={css:n[1],media:n[2],sourceMap:n[3]};-1!==u?(h[u].references++,h[u].updater(d)):h.push({identifier:c,updater:m(d,e),references:1}),s.push(c)}return s}function a(t){var e=document.createElement("style"),s=t.attributes||{};if(void 0===s.nonce){var o=i.nc;o&&(s.nonce=o)}if(Object.keys(s).forEach((function(t){e.setAttribute(t,s[t])})),"function"==typeof t.insert)t.insert(e);else{var h=n(t.insert||"head");if(!h)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");h.appendChild(e)}return e}var c,u=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function d(t,e,i,s){var o=i?"":s.media?"@media ".concat(s.media," {").concat(s.css,"}"):s.css;if(t.styleSheet)t.styleSheet.cssText=u(e,o);else{var n=document.createTextNode(o),h=t.childNodes;h[e]&&t.removeChild(h[e]),h.length?t.insertBefore(n,h[e]):t.appendChild(n)}}function g(t,e,i){var s=i.css,o=i.media,n=i.sourceMap;if(o?t.setAttribute("media",o):t.removeAttribute("media"),n&&btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),t.styleSheet)t.styleSheet.cssText=s;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(s))}}var f=null,p=0;function m(t,e){var i,s,o;if(e.singleton){var n=p++;i=f||(f=a(e)),s=d.bind(null,i,n,!1),o=d.bind(null,i,n,!0)}else i=a(e),s=g.bind(null,i,e),o=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return s(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;s(t=e)}else o()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=o());var i=l(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var s=0;s<i.length;s++){var o=r(i[s]);h[o].references--}for(var n=l(t,e),a=0;a<i.length;a++){var c=r(i[a]);0===h[c].references&&(h[c].updater(),h.splice(c,1))}i=n}}}},function(t,e,i){var s=i(3),o=i(4),n=i(5),h=i(6),r=i(7);e=s(!1);var l=o(n),a=o(h),c=o(r);e.push([t.i,"@font-face { font-family: pixeboy; src: url("+l+"); } \n@font-face { font-family: ka1; src: url("+a+"); } \nhtml, body {\n    margin: 0 !important;\n    padding: 0 !important;\n}\nbody {\n    background: #000000;\n    /* Prevent the ugly blue highlighting from accidental selection of text */ user-select: none;\n    -webkit-touch-callout: none !important;\n    -webkit-user-select: none !important;\n    -khtml-user-select: none !important; /* Konqueror HTML */\n    -moz-user-select: none !important; /* Old versions of Firefox */\n    -ms-user-select: none !important; /* Internet Explorer/Edge */\n\n    overflow: hidden;\n    top: 0; bottom: 0; left: 0; right: 0;\n    \n}\n@media only screen and (min-width: 800px)\n{\n    #wrapper {\n        position: absolute; \n        top: 0; bottom: 0; left: 0; right: 0;\n        background-image: url("+c+");\n        background-size: 100% 100%;\n    }\n}\n@media only screen and (max-width: 800px)\n{\n    /* 小屏幕背景图 */\n    #wrapper {\n        position: absolute; \n        top: 0; bottom: 0; left: 0; right: 0;\n        background-image: url("+c+");\n        background-size: cover;\n    }\n}",""]),t.exports=e},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",s=t[3];if(!s)return i;if(e&&"function"==typeof btoa){var o=(h=s,r=btoa(unescape(encodeURIComponent(JSON.stringify(h)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),"/*# ".concat(l," */")),n=s.sources.map((function(t){return"/*# sourceURL=".concat(s.sourceRoot||"").concat(t," */")}));return[i].concat(n).concat([o]).join("\n")}var h,r,l;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(i,"}"):i})).join("")},e.i=function(t,i,s){"string"==typeof t&&(t=[[null,t,""]]);var o={};if(s)for(var n=0;n<this.length;n++){var h=this[n][0];null!=h&&(o[h]=!0)}for(var r=0;r<t.length;r++){var l=[].concat(t[r]);s&&o[l[0]]||(i&&(l[2]?l[2]="".concat(i," and ").concat(l[2]):l[2]=i),e.push(l))}},e}},function(t,e,i){"use strict";t.exports=function(t,e){return e||(e={}),"string"!=typeof(t=t&&t.__esModule?t.default:t)?t:(/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t)}},function(t,e,i){"use strict";i.r(e),e.default=i.p+"143c9dc71d2a56d4bc46c33e06440ebc.ttf"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"5df8cd545dcd2db2bf8b3093ddd428e3.ttf"},function(t,e,i){"use strict";i.r(e),e.default=i.p+"c1c53ea6dd632d9b0f1ffb7d371cd86a.jpg"},function(t,e,i){"use strict";i.r(e);var s=i.p+"adabb7de6ea9690077c9facc7da0de0f.wav",o=i.p+"bfb42860c69139288dcfac52dc6d9f60.wav",n=i.p+"6919a781914917848bb778a8174fbb00.wav",h=i.p+"26b8654f97b08c024ba4cf4f34d7b4f7.wav",r=i.p+"b56c7b6aa88cf7dab52b4fc0fd854627.mp3";class l{async load(){window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new AudioContext,this.bgmReady=!1,this.audio={};let t=await Promise.all([this.loadSoundBuffer(s),this.loadSoundBuffer(o),this.loadSoundBuffer(n),this.loadSoundBuffer(h),this.loadSoundBuffer(r)]);this.audio.clockwise=t[0],this.audio.left=t[1],this.audio.right=this.audio.left,this.audio.down=this.audio.left,this.audio.hard_drop=t[2],this.audio.clear_line=t[3],this.audio.bgm=t[4],this.bgm=null}loadSoundBuffer(t){let e=this.audioContext;return new Promise((i,s)=>{var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){e.decodeAudioData(o.response,(function(t){i(t)}),(function(){s()}))},o.send()})}playAudioBuffer(t,e,i){this.audioContext.resume();var s=this.audioContext.createBufferSource();s.buffer=t;let o=this.audioContext.createGain();o.gain.setValueAtTime(e,this.audioContext.currentTime),s.connect(o),o.connect(this.audioContext.destination),!0===i&&(s.loop=!0),s.start(0)}playBgmAtFirstTime(t){null===this.bgm&&(this.playAudioBuffer(this.audio.bgm,.3,!0),this.bgm=t)}play(t){t in this.audio&&this.playAudioBuffer(this.audio[t],.2)}}var a=i.p+"153c34eacbc748a364e3523688261f90.png";class c{constructor(){this.virutalCanvas={},this.colors=7,this.colorPosition={red:0,blue:1,yellow:2,green:3,cyan:4,orange:5,purple:6,gray:7}}async load(){this.blockImage=await this.loadImage(a)}loadImage(t){return new Promise((function(e){const i=new Image;i.src=t,i.onload=function(){e(i)}}))}prerenderSkin(t){let e=document.createElement("canvas");e.height=t,e.width=t*this.colors,e.getContext("2d").drawImage(this.blockImage,0,0,t*this.colors,t),this.virutalCanvas[t]=e}drawBlock(t,e,i,s,o,n){s in this.virutalCanvas||this.prerenderSkin(s);const h=this.virutalCanvas[s],r=this.colorPosition[o];t.save(),n<1&&(t.globalAlpha=n),t.drawImage(h,r*s,0,s,s,e,i,s,s),t.restore()}}i(0);var u=new class{constructor(){this.sound=new l,this.image=new c}load(){return console.log(this.sound,this.image),Promise.all([this.sound.load(),this.image.load()])}};function d(t,e,i,s){return i*((t=t/s-1)*t*t*t*t+1)+e}function g(t){let e=null,i=null,s=null,o=null;for(let n of t){const t=n[0],h=n[1];(null==e||t<e)&&(e=t),(null==i||t>i)&&(i=t),(null==s||h<s)&&(s=h),(null==o||h>o)&&(o=h)}return[e,i,s,o]}var f=new class{constructor(){this.dpr=window.devicePixelRatio||1,this.uiCanvas=document.getElementById("ui"),this.spriteCanvas=document.getElementById("game"),this.animationCanvas=document.getElementById("animation"),this.ui=this.uiCanvas.getContext("2d"),this.sprite=this.spriteCanvas.getContext("2d"),this.animation=this.animationCanvas.getContext("2d")}refreshViewPort(t){t&&this.setUpAllCanvas();const e=(s=" -webkit- -moz- -o- -ms- ".split(" "),!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)||(i=["(",s.join("touch-enabled),("),"heartz",")"].join(""),window.matchMedia(i).matches));var i,s;return{width:this.uiCanvas.width,height:this.uiCanvas.height,isTouch:e,dpr:this.dpr}}clearAll(){const t=this.spriteCanvas.width,e=this.spriteCanvas.height;this.sprite.clearRect(0,0,t,e),this.ui.clearRect(0,0,t,e),this.animation.clearRect(0,0,t,e)}setUpAllCanvas(){this.setUpCanvas(this.uiCanvas),this.setUpCanvas(this.spriteCanvas),this.setUpCanvas(this.animationCanvas)}setUpCanvas(t){let e=+getComputedStyle(t).getPropertyValue("height").slice(0,-2),i=+getComputedStyle(t).getPropertyValue("width").slice(0,-2);t.height=e*this.dpr,t.width=i*this.dpr}};const p=22,m=10,b=500,k=2;class w{onGameEvent(t){}keyControl(t,e){if(!(t in this.keyMap))return;const i=this.keyMap[t];if("down"==e){let t=1;if(i in this.keyPressed&&1==this.keyPressed[i]&&(t=0),this.callback(i),this.keyPressed[i]=1,("left"==i||"right"==i||"down"==i)&&t){const t=this;clearTimeout(this.keyTimer[i]),this.keyTimer[i]=setTimeout((function e(){1==t.keyPressed[i]&&(t.callback(i),setTimeout(e,30))}),250)}}else this.keyPressed[i]=0,clearTimeout(this.keyTimer[i]),this.keyTimer[i]=null}install(t){this.keyPressed={},this.keyTimer={},this.callback=t,this.keyMap={ArrowLeft:"left",ArrowRight:"right",ArrowDown:"down",ArrowUp:"clockwise",Space:"hard_drop",MetaLeft:"hold",KeyX:"regret"};let e=this;document.addEventListener("keydown",t=>{e.keyControl(t.code,"down")}),document.addEventListener("keyup",t=>{e.keyControl(t.code,"up")})}}class y{onGameEvent(t){"lockblock"==t&&this.clearTouch()}clearTouch(){this.ongoingTouches=[],this.touchNoMove=[],this.ongoingTouchesStart=[],this.touchTrace=[],this.ongoingTouchesTime=[]}indexForOngoingTouch(t){const e=t.identifier;for(let t=0;t<this.ongoingTouches.length;t++)if(this.ongoingTouches[t].identifier==e)return t;return null}onTouchStart(t,e){e("touch");var i=t.changedTouches;for(let t=0;t<i.length;t++){let e=i[t];this.ongoingTouches.push(e),this.ongoingTouchesStart.push(e),this.touchNoMove.push(!0),this.touchTrace.push([]),this.ongoingTouchesTime.push(Date.now())}}onTouchMove(t,e){var i=t.changedTouches;for(let t=0;t<i.length;t++){let s=i[t];const o=this.indexForOngoingTouch(s);if(null!=o){const t=s.pageY-this.ongoingTouches[o].pageY,i=s.pageX-this.ongoingTouches[o].pageX;let n=null;Math.abs(i)>Math.abs(t)&&i<-18?n="left":Math.abs(i)>Math.abs(t)&&i>18?n="right":Math.abs(t)>Math.abs(i)&&t>18&&(n="down"),null!==n&&(this.ongoingTouches[o]=s,this.touchNoMove[o]=!1,e(n));const h=Date.now();this.touchTrace[o].push([h-this.ongoingTouchesTime[o],[i,t]]),this.ongoingTouchesTime[o]=h}}}onTouchEnd(t,e){var i=t.changedTouches;for(let t=0;t<i.length;t++){let s=i[t];const o=this.indexForOngoingTouch(s);if(null!=o){const t=s.pageY-this.ongoingTouchesStart[o].pageY,i=s.pageX-this.ongoingTouchesStart[o].pageX;if(Math.abs(i)<=18&&Math.abs(t)<=18&&this.touchNoMove[o])e("clockwise");else{let t=0,i=[0,0],s=[0,0],n=0;for(let e=this.touchTrace[o].length-1;e>=0;e--)if(s[0]+=this.touchTrace[o][e][1][0],s[1]+=this.touchTrace[o][e][1][1],n+=this.touchTrace[o][e][0],n>0){let e=Math.sqrt(s[0]**2+s[1]**2)/n;e>t&&(t=e,i[0]=s[0],i[1]=s[1])}t>1.2&&Math.abs(i[1])>Math.abs(i[0])&&i[1]>1.3*18?e("hard_drop"):t>1.2&&i[1]<-36&&Math.abs(i[1])>Math.abs(i[0])&&e("regret")}this.ongoingTouches.splice(o),this.touchNoMove.splice(o),this.ongoingTouchesStart.splice(o),this.touchTrace.splice(o),this.ongoingTouchesTime.splice(o)}}}install(t){this.clearTouch();const e=this;document.addEventListener("touchstart",i=>{e.onTouchStart(i,t)}),document.addEventListener("touchmove",i=>{e.onTouchMove(i,t)}),document.addEventListener("touchend",i=>{e.onTouchEnd(i,t)}),document.addEventListener("touchcancel",i=>{e.onTouchEnd(i,t)})}}class v{constructor(t,e,i){this.rows=p+k,this.cols=m,this.newState=this.createEmptyField(),this.relocate(t,e,i)}createEmptyField(){let t=[];for(let e=0;e<this.rows;e++){let e=new Array(this.cols);for(let t=0;t<this.cols;t++)e[t]=null;t.push(e)}return t}setBlockField(t,e,i,s){this.newState=this.createEmptyField();for(let t of e)this.newState[t[0]][t[1]]=[i,.2];for(let e of t)this.newState[e[0]][e[1]]=[i,1];for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++)null!==s[t][e]&&(this.newState[t][e]=[s[t][e],1])}relocate(t,e,i){this.x=t,this.y=e,this.blockSize=i,this.lastState=this.createEmptyField()}setRedrawLines(t){for(let e of t)for(let t=0;t<this.cols;++t)this.lastState[e][t]=null}clear(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++){const i=this.lastState[t][e],s=this.newState[t][e];null==i&&null==s||null!=i&&null!=s&&i[0]==s[0]&&i[1]==s[1]||this.clearBlock(t,e)}}draw(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++){const i=this.lastState[t][e],s=this.newState[t][e];null==i&&null==s||null!=i&&null!=s&&i[0]==s[0]&&i[1]==s[1]||null!=s&&this.drawBlock(t,e,s[0],s[1])}this.lastState=this.newState}clearBlock(t,e){if(t<2)return;const i=e*this.blockSize+this.x,s=(t-2)*this.blockSize+this.y;f.sprite.clearRect(i,s,this.blockSize,this.blockSize)}drawBlock(t,e,i,s){if(t<2)return;const o=e*this.blockSize+this.x,n=(t-2)*this.blockSize+this.y;u.image.drawBlock(f.sprite,o,n,this.blockSize,i,s)}}class S{constructor(t,e,i,s,o){this.title=o,this.relocate(t,e,i,s)}relocate(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s,this.textDirty=!0,this.uiDirty=!0}clear(){if(this.uiDirty){f.ui.clearRect(this.x,this.y,this.width,this.height)}if(this.textDirty){f.sprite.clearRect(this.x,this.y,this.width,this.height)}}draw(){if(this.uiDirty){let t=f.ui;t.save(),t.fillStyle="rgb(0,0,0,0.85)",t.fillRect(this.x,this.y,this.width,this.height),t.restore(),this.uiDirty=!1}if(this.textDirty){let t=f.sprite;t.save(),t.fillStyle="white",t.font=this.height+1+"px pixeboy",t.fillText(this.title,this.x,this.y+this.height),t.restore(),this.textDirty=!1}}}class T{constructor(t,e,i,s,o,n,h){this.titleBar=new S(t,e,i,o,n),this.content=h,this.relocate(t,e,i,s,o)}setContent(t){t!==this.content&&(this.content=t,this.contentDirty=!0)}relocate(t,e,i,s,o){this.x=t,this.y=e,this.width=i,this.height=s,this.titleHeight=o,this.uiDirty=!0,this.contentDirty=!0,this.titleBar.relocate(t,e,i,o)}clear(){if(this.titleBar.clear(),this.uiDirty){f.ui.clearRect(this.x,this.y+this.titleHeight,this.width,this.height-this.titleHeight)}if(this.contentDirty){f.sprite.clearRect(this.x,this.y+this.titleHeight,this.width,this.height-this.titleHeight)}}draw(){if(this.titleBar.draw(),this.uiDirty){let t=f.ui;t.save(),t.fillStyle="rgb(0,0,0,0.6)",t.fillRect(this.x,this.y+this.titleHeight,this.width,this.height-this.titleHeight),t.restore(),this.uiDirty=!1}if(this.contentDirty){let t=f.sprite;t.save(),t.fillStyle="white",t.font=this.calculateFontSize(this.content)+"px ka1",t.fillText(this.content,this.x+2,this.y+2*this.titleHeight),this.contentDirty=!1,t.restore()}}calculateFontSize(t){const e=f.sprite;let i=this.titleHeight-3;for(;i>3;){if(e.font=i+"px ka1",e.measureText(t).width+5<this.width)break;i-=1}return i}}class x{constructor(t,e,i,s,o){this.relocate(t,e,i,s,o)}relocate(t,e,i,s,o){this.x=t,this.y=e,this.width=i,this.height=s,this.blockSize=o,this.dirty=!0}clear(){if(this.dirty){f.ui.fillRect(this.x,this.y,this.width,this.height)}}draw(){if(this.dirty){const t=f.ui;t.save(),t.fillStyle="rgb(0,0,0,1.0)",t.fillRect(this.x,this.y,this.width,this.height),t.strokeStyle="rgb(30,30,30)",t.lineWidth=2,t.beginPath();for(let e=1;e<m;++e)t.moveTo(this.x+e*this.blockSize,this.y),t.lineTo(this.x+e*this.blockSize,this.height+this.y);for(let e=1;e<p;++e)t.moveTo(this.x,this.y+e*this.blockSize),t.lineTo(this.x+this.width,this.y+e*this.blockSize);t.stroke(),t.restore(),this.dirty=!1}}}class C{constructor(t,e,i,s,o,n,h){this.panel=new T(t,e,i,s,o,n,""),this.title=n,this.relocate(t,e,i,s,o),this.setBlocks(h)}setBlocks(t){let e=!1;if(this.blocks&&t.length==this.blocks.length){for(let i=0;i<this.blocks.length;i++)if(t[i]!=this.blocks[i]){e=!0;break}}else e=!0;if(e){this.blocks=[];for(let e of t)this.blocks.push(e);this.blockDirty=!0}}relocate(t,e,i,s,o){this.panel.relocate(t,e,i,s,o),this.x=t,this.y=e,this.width=i,this.height=s,this.titleHeight=o,this.blockDirty=!0}clear(){this.panel.clear(),this.blockDirty&&f.sprite.clearRect(this.x,this.y+this.titleHeight,this.width,this.height-this.titleHeight)}draw(){this.panel.draw(),this.blockDirty&&(f.sprite.save(),this.drawBlocks(),this.blockDirty=!1,f.sprite.restore())}drawBlocks(){const t=Math.round(.8*this.width/4),e=Math.round((this.height-this.titleHeight)/this.blocks.length*.85/2),i=Math.min(t,e),s=Math.round((this.height-this.titleHeight)/this.blocks.length);for(let t=0;t<this.blocks.length;t++){const e=this.blocks[t],o=e.positions(0,0,0),[n,h,r,l]=g(o),a=(l-r+1)*i,c=(h-n+1)*i,d=Math.round((this.width-a)/2),p=Math.round((s-c)/2),m=this.x,b=this.y+this.titleHeight+t*s;for(let t=0;t<o.length;++t){let s=(o[t][1]-r)*i+m+d,h=(o[t][0]-n)*i+b+p;u.image.drawBlock(f.sprite,s,h,i,e.style,1)}}}}class M{constructor(t){this.board=new x(0,0,0,0,0),this.blockField=new v(0,0,0),this.previewPanel=new C(0,0,0,0,0,"next",[]),this.scorePanel=new T(0,0,0,0,0,"score",""),this.clearLinePanel=new T(0,0,0,0,0,"lines",""),this.timePanel=new T(0,0,0,0,0,"time",""),this.regretPanel=new T(0,0,0,0,0,"regret",""),this.holdPanel=new C(0,0,0,0,0,"hold",[]),this.children=[this.blockField,this.board,this.scorePanel,this.clearLinePanel,this.timePanel,this.regretPanel,this.previewPanel,this.holdPanel],this.relocate(t)}relocate(t){const e=Math.round(1.4*m)/p;let i,s=!1;t.height*e<t.width?i=Math.round(.95*t.height/p):(i=Math.round(.95*t.width/1.4/m),s=!0);const o=i*m,n=i*p,h=Math.round((t.width-1.4*o)/2);let r;r=s&&t.isTouch?Math.round((t.height-n)/7):Math.round((t.height-n)/2),this.board.relocate(h,r,o,n,i),this.blockField.relocate(h,r,i);const l=Math.round(n/30),a=h+o,c=Math.round(.4*o),u=r,d=Math.round(.33*t.height);this.previewPanel.relocate(a,u,c,d+l,l);const g=u+l+d,f=Math.round(.05*t.height);this.scorePanel.relocate(a,g,c,f+l,l);const b=g+l+f;this.clearLinePanel.relocate(a,b,c,f+l,l);const k=b+l+f;this.timePanel.relocate(a,k,c,f+l,l);const w=k+f+l;this.regretPanel.relocate(a,w,c,f+l,l);const y=w+f+l,v=Math.round(.15*t.height);this.holdPanel.relocate(a,y,c,v+l,l),this.gameX=h,this.gameY=r,this.gameWidth=o,this.gameHeight=n,this.blockSize=i}clear(){for(let t of this.children)t.clear()}draw(){for(let t of this.children)t.draw()}setGameStates(t){const e=t;this.blockField.setBlockField(e.getBlockPositions(),e.getPredictedPositions(),e.getBlockStyle(),e.getStack()),this.scorePanel.setContent(e.getScore()),this.clearLinePanel.setContent(e.getLineCount()),this.timePanel.setContent(e.getUsedTime()),this.regretPanel.setContent(e.getRegretCount()),this.previewPanel.setBlocks(e.getNextBlocks()),this.holdPanel.setBlocks(e.getHold())}}class B{constructor(t,e,i){this.shapes=t,this.style=i,this.kickTable=null,"other"==e?this.kickTable={0:{1:[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]],3:[[0,0],[1,0],[1,1],[0,-2],[1,-2]]},1:{2:[[0,0],[1,0],[1,-1],[0,2],[1,2]],0:[[0,0],[1,0],[1,-1],[0,2],[1,2]]},2:{3:[[0,0],[1,0],[1,1],[0,-2],[1,-2]],1:[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]]},3:{0:[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],2:[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]]}}:"I"==e&&(this.kickTable={0:{1:[[0,0],[-2,0],[1,0],[-2,-1],[1,2]],3:[[0,0],[-1,0],[2,0],[-1,2],[2,-1]]},1:{2:[[0,0],[-1,0],[2,0],[-1,2],[2,-1]],0:[[0,0],[2,0],[-1,0],[2,1],[-1,-2]]},2:{3:[[0,0],[2,0],[-1,0],[2,1],[-1,-2]],1:[[0,0],[1,0],[-2,0],[1,-2],[-2,1]]},3:{0:[[0,0],[1,0],[-2,0],[1,-2],[-2,1]],2:[[0,0],[-2,0],[1,0],[-2,-1],[1,2]]}}),this.offsets=[],this.boundingBoxWidth=t[0][1].length;for(let e=0;e<t.length;++e){const i=t[e],s=[];for(let t=0;t<i.length;++t)for(let e=0;e<i[t].length;++e)1==i[t][e]&&s.push([t,e]);this.offsets.push(s)}}getRotationNumber(t){let e;return e=t<0?(4- -t%4)%4:t%4,e}positions(t,e,i){let s=this.getRotationNumber(i);const o=this.offsets[s];let n=[];for(let i=0;i<o.length;++i){let s=o[i];n.push([t+s[0],e+s[1]])}return n}collide(t,e,i,s){const o=this.positions(e,i,s);for(let e=0;e<o.length;++e){const i=o[e];if(i[0]<0||i[1]<0||i[0]>=t.length||i[1]>=t[i[0]].length)return!0;if(null!==t[i[0]][i[1]])return!0}return!1}rotate(t,e,i,s,o){const n=this.getRotationNumber(s),h=this.getRotationNumber(s+o);if(null==this.kickTable)return this.collide(t,e,i,h)?[e,i,n]:[e,i,h];const r=this.kickTable[n][h];for(let s in r){const o=r[s];if(!this.collide(t,e-o[1],i+o[0],h))return[e-o[1],i+o[0],h]}return[e,i,n]}move(t,e,i,s,o){let n=e,h=i,r=s;if("clockwise"==o)return this.rotate(t,e,i,s,1);if("counter_clockwise"==o)return this.rotate(t,e,i,s,-1);if("left"==o)h-=1;else if("right"==o)h+=1;else if("down"==o)n+=1;else if("hard_drop"==o){let o=this.positions(e,i,s),h=t.length-1;for(let e=0;e<o.length;++e){let i=o[e][1],s=o[e][0];h=Math.min(h,t.length-s-1);for(let e=s+1;e<t.length;++e)if(null!==t[e][i]){let t=e-s-1;h=Math.min(t,h);break}}n+=h}return this.collide(t,n,h,r)?[e,i,s]:[n,h,r]}}let P=new B([[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]]],"other","blue"),F=new B([[[1,1,0],[0,1,1],[0,0,0]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,0],[1,1,0],[0,1,1]],[[0,1,0],[1,1,0],[1,0,0]]],"other","red"),R=new B([[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]],"other","orange"),I=new B([[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],"I","cyan"),z=new B([[[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0]]],null,"yellow"),D=new B([[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]],"other","purple"),L=new B([[[0,1,1],[1,1,0],[0,0,0]],[[0,1,0],[0,1,1],[0,0,1]],[[0,0,0],[0,1,1],[1,1,0]],[[1,0,0],[1,1,0],[0,1,0]]],"other","green");class A{constructor(t,e,i){this.rows=p+k,this.cols=m,this.candidates=[P,F,R,I,z,D,L],this.startLevel=1,this.onLockBlock=t||(()=>{}),this.onGameOver=e||(()=>{}),this.onHarddrop=i||(()=>{}),this.storage=window.localStorage,this.reset()}createEmptyStack(){let t=[];for(let e=0;e<this.rows;e++){let e=new Array(this.cols);for(let t=0;t<this.cols;++t)e[t]=null;t.push(e)}return t}reset(){this.stack=this.createEmptyStack(),this.block=null,this.blockRow=null,this.blockCol=null,this.tspin=!1,this.rotation=null,this.nextBlocks=[],this.hold=null,this.holdTime=0,this.beginTime=null,this.endTime=null,this.randomBlocks=[],this.history=[],this.score=0,this.combo=0,this.regretCount=5,this.lineCount=0,this.level=this.startLevel,this.levelClearCount=0}addSnapshot(){let t={stack:(e=this.stack,JSON.parse(JSON.stringify(e))),block:this.block,blockRow:this.blockRow,blockCol:this.blockCol,tspin:this.tspin,rotation:this.rotation,nextBlocks:this.nextBlocks.slice(),hold:this.hold,holdTime:this.holdTime,randomBlocks:this.randomBlocks.slice(),score:this.score,combo:this.combo,lineCount:this.lineCount,level:this.level,levelClearCount:this.levelClearCount};var e;this.history.push(t),this.history.length>10&&this.history.shift()}rewind(){if(0==this.history.length)return!1;let t=this.history.pop();for(let e in t)this[e]=t[e];return this.resetDelayTimer(),this.resetFallTimer(),!0}restart(){this.reset(),this.beginTime=Date.now(),this.endTime=null,this.nextBlocks=[this.pickBlock(),this.pickBlock(),this.pickBlock()],this.triggerNextDrop()}getScore(){return this.score}getHold(){return null===this.hold?[]:[this.hold]}getNextBlocks(){return this.nextBlocks}getLineCount(){return this.lineCount}getRegretCount(){return this.regretCount}getUsedTime(){if(null==this.beginTime)return"";let t;return t=this.endTime?this.endTime:Date.now(),function(t){parseInt(t%1e3/100);let e=Math.floor(t/1e3%60),i=Math.floor(t/6e4%60),s=Math.floor(t/36e5%24);return s=s<10?"0"+s:s,i=i<10?"0"+i:i,e=e<10?"0"+e:e,s+":"+i+":"+e}(t-this.beginTime)}triggerNextDrop(){this.state="dropping",this.tspin=!1,this.isPerfect=!1,this.fullLines=[],this.holdTime=0,this.nextBlocks.push(this.pickBlock()),this.resetDelayTimer(),this.resetFallTimer(),this.spawnNewBlock(this.nextBlocks.shift())?this.addSnapshot():(this.state="over",this.endTime=Date.now(),this.stopFallTimer(),this.onGameOver())}cannotFall(){return!(null==this.block||!this.block.collide(this.stack,this.blockRow+1,this.blockCol,this.rotation))}spawnNewBlock(t){this.block=t;const e=Math.floor(this.cols/2),i=this.block.boundingBoxWidth;return this.blockRow=1,this.blockCol=e-Math.ceil(i/2),this.rotation=0,!this.block.collide(this.stack,this.blockRow,this.blockCol,this.rotation)||(this.block=null,this.blockCol=null,this.blockRow=null,this.rotation=null,!1)}move(t){if(this.tspin=!1,null==this.block)return null;const e=this.block.move(this.stack,this.blockRow,this.blockCol,this.rotation,t),i=e[0]-this.blockRow,s=e[0],o=e[1],n=e[2];let h="normal";if(s==this.blockRow&&o==this.blockCol&&n==this.rotation)h="stuck";else if(("clockwise"==t||"counter_clockwise"==t)&&this.block==D){let t=[[s,o],[s+2,o],[s,o+2],[s+2,o+2]],e=0;for(let i of t)i[0]<0||i[0]>=this.rows||i[1]<0||i[1]>=this.cols||null!=this.stack[i[0]][i[1]]&&(e+=1);e>=3&&(h="tspin",this.tspin=!0)}return this.blockRow=s,this.blockCol=o,this.rotation=n,{newRow:s,newCol:o,newRotation:n,dropStep:i,moveType:h}}getFullLines(){let t=[],e=!0;for(let i=0;i<this.rows;i++)this.stack[i].every(t=>null!==t)?t.push(i):e=!1;return[t,e]}getPredictedPositions(){if(null==this.block)return[];const t=this.block.move(this.stack,this.blockRow,this.blockCol,this.rotation,"hard_drop");return this.block.positions(t[0],t[1],t[2])}clearLines(){const t=this.fullLines,e=this.isPerfect,i=this.tspin;this.updateClearLineScore(t.length,e,i),t.sort();for(let e=t.length-1;e>=0;e--)this.stack.splice(t[e],1);for(let e=0;e<t.length;e++){let t=new Array(this.cols);for(let e=0;e<this.cols;++e)t[e]=null;this.stack.unshift(t)}this.fullLines=[],this.isPerfect=!1,this.tspin=!1}stopFallTimer(){clearTimeout(this.fallTimerId)}dropSpeed(){return 1e3*Math.pow(.8-.007*(this.level-1),this.level-1)}resetFallTimer(){this.stopFallTimer();const t=this.dropSpeed(),e=this;this.fallTimerId=setTimeout((function(){e.control("fall"),e.resetFallTimer()}),t)}lockBlock(){this.stopFallTimer();let t=this.block.positions(this.blockRow,this.blockCol,this.rotation);for(let e of t)this.stack[e[0]][e[1]]=this.block.style;this.block=null,this.blockRow=null,this.blockCol=null,this.rotation=null;const e=this.getFullLines();this.isPerfect=e[1],this.fullLines=e[0],this.state="locked",this.onLockBlock(t,this.fullLines,this.isPerfect,this.tspin)}resetDelayTimer(){clearTimeout(this.lockDelayTimer);const t=this;this.lockDelayTimer=setTimeout((function(){t.cannotFall()&&t.lockBlock()}),b)}pickBlock(){if(0==this.randomBlocks.length){for(let t in this.candidates)this.randomBlocks.push(this.candidates[t]);!function(t){for(let e=t.length-1;e>0;e--){let i=Math.floor(Math.random()*(e+1)),s=t[e];t[e]=t[i],t[i]=s}}(this.randomBlocks)}return this.randomBlocks.shift()}getBlockStyle(){return this.block?this.block.style:null}getStack(){return this.stack}getBlock(){return this.block}getBlockPositions(){return this.block?this.block.positions(this.blockRow,this.blockCol,this.rotation):[]}control(t){if("dropping"==this.state&&"hold"!=t&&"regret"!=t){let e=null;"down"==t?e="soft":"hard_drop"==t&&(e="hard"),"fall"==t&&(t="down");const i=this.move(t);"stuck"!=i.moveType&&this.resetDelayTimer(),this.updateDropScore(i.dropStep,e),"hard_drop"==t&&(this.onHarddrop(this.getBlockPositions()),this.lockBlock())}else if("dropping"==this.state&&"hold"==t)if(0==this.holdTime){let t;if(null==this.hold)this.hold=this.block,t=this.nextBlocks.shift(),this.nextBlocks.push(this.pickBlock());else{let e=this.block;t=this.hold,this.hold=e}this.spawnNewBlock(t),this.resetDelayTimer(),this.holdTime=1}else console.log("cannot hold two times");else"dropping"==this.state&&"regret"==t&&(this.regret()||console.log("cannot regret"))}regret(){return this.regretCount>0&&(!!this.rewind()&&(this.regretCount-=1,!0))}updateDropScore(t,e){"soft"==e?this.score+=t:"hard"==e&&(this.score+=2*t)}updateClearLineScore(t,e,i){if(0==t)return this.combo=0,void(i&&(this.score+=400*this.level));this.combo+=1,this.lineCount+=t,this.levelClearCount+=t;let s=0;s=i?[null,800,1200,1600,null][t]:[null,100,300,500,800][t],e&&(s+=[null,800,1e3,1800,200][t]),s*=this.level,this.combo>1&&(s+=this.level*(this.combo-1)*50),4==t&&(this.regretCount+=1),this.levelClearCount>10&&(this.level+=1,this.levelClearCount-=10)}getScoreRank(){let t=this.storage.getItem("score_rank");return null==t?[]:JSON.parse(t)}addToScoreRank(t,e,i){let s=this.getScoreRank(),o=(n=new Date,h=n.getHours(),r=n.getMinutes(),l=h+":"+(r=r<10?"0"+r:r),n.getFullYear()+"/"+(n.getMonth()+1)+"/"+n.getDate()+"  "+l);var n,h,r,l;s.push({score:t,useTime:e,clearLine:i,playedAt:o}),s.sort((t,e)=>t.score>e.score||t.score==e.score&&t.playedAt>e.playedAt?-1:e.score>t.score||t.score==e.score&&e.playedAt>t.playedAt?1:0),s.length>10&&(s=s.slice(0,10)),this.storage.setItem("score_rank",JSON.stringify(s))}}class U{constructor(t){let e=["rgb(255,29,88)","rgb(24,89,144)","rgb(255,246,133)","rgb(0,221,255)","rgb(0,73,183)"];this.color=e[Math.floor(Math.random()*e.length)],this.size=t,this.progress=0,this.duration=0}setDuration(t){this.duration=t}finished(){return this.progress>=this.duration}boundingBox(t,e){return[t,e,this.size,this.size]}draw(t,e){if(this.finished())return;const i=1-this.progress/this.duration,s=f.animation;s.save(),s.fillStyle=this.color,s.globalAlpha=i,s.fillRect(t,e,this.size,this.size),this.progress+=1,s.restore()}}class E{constructor(){this.particles=[]}boundingBox(){let t=null,e=null,i=null,s=null;for(let o of this.particles){let n=o.x+o.xInitSpeed*o.progress,h=o.y+o.yInitSpeed*o.progress+.01*o.gravity*(o.progress*o.progress),[r,l,a,c]=o.particle.boundingBox(n,h);(null==t||r<t)&&(t=r),(null==e||r+a>e)&&(e=r+a),(null==i||l<i)&&(i=l),(null==s||l+c>s)&&(s=l+c)}return[t,i,e-t+1,s-i+1]}clear(){if(this.particles.length>0){let[t,e,i,s]=this.boundingBox();f.animation.clearRect(t,e,i,s)}}play(){let t=[];for(let e of this.particles)if(e.progress<e.duration){e.progress+=1,t.push(e);let i=e.x+e.xInitSpeed*e.progress,s=e.y+e.yInitSpeed*e.progress+.01*e.gravity*(e.progress*e.progress);e.particle.draw(i,s)}this.particles=t}add(t,e,i,s,o,n,h){const r=2*Math.PI-s%360/360*(2*Math.PI);t.setDuration(h),this.particles.push({particle:t,progress:0,duration:h,gravity:n,x:e,y:i,xInitSpeed:Math.cos(r)*o,yInitSpeed:Math.sin(r)*o})}}class N{constructor(){this.animations=[],this.particles=new E}add(t){t.setManager(this),this.animations.push(t)}play(){for(let t=0;t<this.animations.length;++t){this.animations[t].clear()}this.particles.clear();let t=[];for(let e=0;e<this.animations.length;++e){const i=this.animations[e];i.play(),i.finished()||t.push(i)}this.animations=t,this.particles.play()}}class H{constructor(t,e,i,s,o,n){this.x=t,this.y=e,this.blockSize=i,this.positions=s,this.duration=o,this.progress=1,this.firstPhase=Math.round(.5*this.duration),this.onFinish=n||(()=>{}),this.isFinished=!1,this.manager=null}finished(){return this.isFinished}setManager(t){this.manager=t}clear(){const t=f.animation;for(let e of this.positions){let i=e[1]*this.blockSize+this.x,s=(e[0]-k)*this.blockSize+this.y;t.clearRect(i,s,this.blockSize,this.blockSize)}}play(){if(this.progress>this.duration)return void(this.isFinished||(this.isFinished=!0,this.onFinish&&this.onFinish()));const t=f.animation;t.save();for(let e of this.positions){let i=e[1]*this.blockSize+this.x,s=(e[0]-k)*this.blockSize+this.y;if(this.progress<=this.firstPhase){const e=this.progress/this.firstPhase*.8;t.fillStyle="rgba(255,255,255,"+e+")"}else{const e=.8-(this.progress-this.firstPhase)/(this.duration-this.firstPhase)*.8;t.fillStyle="rgba(255,255,255,"+e+")"}t.fillRect(i,s,this.blockSize,this.blockSize)}t.restore(),this.progress+=1}}class _{constructor(t,e,i,s,o,n){this.x=t,this.y=e,this.blockSize=i,this.positions=s,this.duration=o,this.progress=1,this.onFinish=n||(()=>{}),this.isFinished=!1,this.manager=null,this.boundary=this.getBoundary(t,e,i,s),this.clearBox=[this.boundary[1],e,this.boundary[2]-this.boundary[1],this.boundary[3]-e],console.log(this.clearBox)}getBoundary(t,e,i,s){let o={},n=0,h=p+k;for(let t of s){const e=t[0],i=t[1];o[i]=i in o?Math.min(e,o[i]):e,n=Math.max(e,n),h=Math.min(e,h)}let r=[];for(let s in o)r.push([e+(o[s]-k)*i,t+s*i]);return r.sort((t,e)=>t[1]-e[1]),[r,r[0][1],r[r.length-1][1]+i,e+(n-k)*i,e+(h-k)*i]}setManager(t){this.manager=t}finished(){return this.isFinished}clear(){f.animation.clearRect(this.clearBox[0],this.clearBox[1],this.clearBox[2],this.clearBox[3])}play(){const t=f.animation;if(this.progress>this.duration)this.isFinished||(this.isFinished=!0,this.onFinish&&(this.clear(),this.onFinish()));else{t.save();for(let e of this.boundary[0]){const i=Math.round(6*this.blockSize);let s=t.createLinearGradient(e[1],this.boundary[4]+Math.round(1.2*this.blockSize),e[1],this.boundary[4]-i+Math.round(1.2*this.blockSize)),o=.6-d(this.progress,.1,.5,this.duration),n=1-this.progress/this.duration;s.addColorStop(o,"rgb(80,80,80,"+n+")"),s.addColorStop(1,"rgb(0,0,0,0)"),t.fillStyle=s;const h=Math.max(this.y,e[0]-i),r=Math.min(e[0]-h,i);t.fillRect(e[1],h,this.blockSize,r)}this.progress+=1,t.restore()}}}class O{constructor(t,e,i,s,o,n){this.x=t,this.y=e,this.width=i,this.height=s,this.duration=o,this.progress=1,this.onFinish=n||(()=>{}),this.isFinished=!1,this.manager=null,this.firstPhase=Math.round(.4*this.duration),this.secondPhase=this.duration-this.firstPhase,this.particleSize=Math.round(.25*this.height)}setManager(t){this.manager=t}finished(){return this.isFinished}clear(){f.animation.clearRect(this.x,this.y,this.width,this.height)}play(){if(this.progress>this.duration)return void(this.isFinished||(this.isFinished=!0,this.onFinish&&this.onFinish()));const t=f.animation;if(this.progress<=this.firstPhase){t.save();const e=this.progress/this.firstPhase;t.fillStyle="rgba(255,255,255,"+e+")",t.restore()}else{this.progress==this.firstPhase+1&&f.sprite.clearRect(this.x,this.y,this.width,this.height);let t=f.animation;t.save();const e=1-(this.progress-this.firstPhase)/this.secondPhase;t.fillStyle="rgba(255,255,255,"+e+")";const i=this.width*(1-(this.progress-this.firstPhase)/this.secondPhase),s=this.x+Math.round((this.width-i)/2);t.fillRect(s,this.y,i,this.height);for(let t=0;t<4;++t)this.manager.particles.add(new U(this.particleSize),s,this.y+Math.round(this.height/2),90+45*Math.random(),10+5*Math.random(),20,35),this.manager.particles.add(new U(this.particleSize),s+i,this.y+Math.round(this.height/2),45+45*Math.random(),10+5*Math.random(),20,35);t.restore()}this.progress+=1}}class j{constructor(t,e){this.animations=[];for(let e of t)this.animations.push(e);this.onFinish=e||(()=>{}),this.isFinished=!1}setManager(t){for(let e of this.animations)e.setManager(t)}finished(){return this.isFinished}clear(){for(let t of this.animations)t.clear()}play(){const t=this.isFinished;if(!t){this.isFinished=!0;for(let t of this.animations)t.play(),t.finished()||(this.isFinished=!1);this.isFinished&&t!=this.isFinished&&this.onFinish()}}}class X{constructor(){this.inputs=[],this.gameUI=null,this.animation=new N,this.tetris=new A((t,e,i,s)=>{let o=e.map(this.createClearLineAnimation.bind(this));this.animation.add(new H(this.gameUI.gameX,this.gameUI.gameY,this.gameUI.blockSize,t,25)),this.animation.add(new j(o,()=>{this.gameUI.blockField.setRedrawLines(e),this.tetris.clearLines(),this.tetris.triggerNextDrop()}))},()=>{console.log("gameover")},t=>{this.animation.add(new _(this.gameUI.gameX,this.gameUI.gameY,this.gameUI.blockSize,t,40))})}createClearLineAnimation(t){const e=this.gameUI.gameX,i=this.gameUI.gameY+(t-k)*this.gameUI.blockSize,s=this.gameUI.gameWidth,o=this.gameUI.blockSize;return new O(e,i,s,o,26)}installInput(t){const e=this;t.install((function(t){e.control(t)})),this.inputs.push(t)}relocate(t){const e=f.refreshViewPort(t);t&&f.clearAll(),null===this.gameUI?this.gameUI=new M(e):this.gameUI.relocate(e)}draw(){this.gameUI.clear(),this.gameUI.draw()}run(){this.tetris.restart();const t=this;!function e(){t.gameUI.setGameStates(t.tetris),t.draw(),t.animation.play(),requestAnimationFrame(e)}()}control(t){u.sound.playBgmAtFirstTime(1),t in{left:1,right:1,down:1,clockwise:1,counter_clockwise:1,hard_drop:1,hold:1,regret:1}&&this.tetris.control(t)}}window.addEventListener("load",(function(){u.load().then(()=>{let t=new X;t.relocate(!0),t.installInput(new w),t.installInput(new y),window.addEventListener("resize",(function(){t.relocate(!0)})),t.run()})}))}]);